<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width">  
    <title>ユニコエ用ライブラリ作成ツール</title>
    <script type="text/javascript" src="../lib/jquery/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="../lib/zlib/zlib.min.js"></script>
  </head>
  <body>
    <div class="display"></div>

    <form method="post" action="">
      <label for="voicevox">
        <input type="radio" id="voicevox" name="engine" value="voicevox">
        VOICEVOX
      </label>
      <label for="coeiroink">
        <input type="radio" id="coeiroink" name="engine" value="coeiroink">
        COEIROINK
      </label>


    </form>
    <button type="button" id="execution" disabled onclick="pushexec()">
      実行
    </button>


<!--     <table class="content-table">
      <thead>
        <tr>

        </tr>
      </thead>
    </table> -->

    <script language="javascript" type="text/javascript">

      var speakers_data = [];
      var speaker_info_data = [];
      var table = document.createElement('table');

      window.addEventListener('DOMContentLoaded', function(){
        var input_engines = document.querySelectorAll("input[name=engine]");

        for(var element of input_engines) {
          element.addEventListener('change',function(){
            document.getElementById(execution);
            execution.disabled = false;
          });

        }
      });


      function getspeakers(api_url){
        return new Promise ((resolve) => {
          console.log("Start getting speakers");
          let speakers_data = $.getJSON(`${api_url}speakers`, (speakers)=>{
              speakers_data = speakers;
              return speakers_data;
            });
          console.log("Got speakers")
          resolve(speakers_data);
        });
      }

      async function getspeaker_info(api_url,speakers_data){

        let results = [];
          console.log("Start getting speaker info");
            for (let i=0; i<speakers_data.length; i++){
              results.push(
              $.getJSON(`${api_url}speaker_info?speaker_uuid=${speakers_data[i].speaker_uuid}`, (speaker_info)=>{
              }));
            };
        let speaker_info_data = (await Promise.all(results));
        console.log("Got speaker info")
        return speaker_info_data;
      }

      async function getdata(api_url){
        let speakers_data = await getspeakers(api_url);
        let speaker_info_data = await getspeaker_info(api_url,speakers_data);
        /* console.log(speakers_data);
        console.log(speaker_info_data); */
        return [speakers_data,speaker_info_data] ;
      }

      function makeTable(speakers_data,speaker_info_data,tableId){
        let rows = [];
        let table =document.createElement("table");

        for (i=0; i<speakers_data.length+speakers_data[i].styles.length; i++){
          
        }
      }
        
      
      
      async function pushexec(){
        console.log('button click');
        const libtype = $('input:radio[name="engine"]:checked').val();
        console.log(`libtype=${libtype}`);
        if(libtype=="voicevox"){
          var port_number = "50021";
        }else if(libtype=="coeiroink"){
          var port_number = "50031";
        }
        let api_url = `http://localhost:${port_number}/`;
        console.log(api_url);

        let API_data = await getdata(api_url);

        speakers_data = API_data[0];
        speaker_info_data = API_data[1];


      }
    </script>

  </body>
</html>